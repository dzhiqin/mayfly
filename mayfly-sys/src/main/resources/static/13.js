(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{260:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return r}));var o=a(18),n={resource:o.a.code("resource"),save:o.a.code("resource:save"),update:o.a.code("resource:update"),del:o.a.code("resource:delete")},s={role:o.a.code("role"),del:o.a.code("role:delete"),saveResources:o.a.code("role:saveResources")},r={account:o.a.code("account"),del:o.a.code("account:delete"),saveRoles:o.a.code("account:saveRoles")}},261:function(e,t,a){"use strict";var o={name:"HelpHint",props:{placement:{default:"top"},content:String},data:function(){return{}}},n=a(66),s=Object(n.a)(o,(function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("span",{staticStyle:{"margin-right":"8px"}},[this._t("default")],2),this._v(" "),t("el-tooltip",{attrs:{content:this.content,placement:this.placement}},[t("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"}})])],1)}),[],!1,null,null,null);t.a=s.exports},754:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return b}));var o=a(200),n=a.n(o),s=a(201),r=a.n(s),i=a(215),l=a(261),c=a(260),u=(a(19),a(214)),d={name:"RoleEdit",props:{visible:!1,account:[Object,Boolean]},data:function(){return{btnLoading:!1,allRole:[],roles:[],query:{name:null,pageNum:1,pageSize:5},total:0}},watch:{account:{handler:function(){var e=this;this.account&&u.a.roleIds.request({id:this.account.id}).then((function(t){e.roles=t,e.search()}))},deep:!0}},methods:{handlePageChange:function(e){this.search()},select:function(e,t){var a=this.roles;if(a.includes(t.id))for(var o=0;o<a.length;o++){if(a[o]===t.id){a.splice(o,1);break}}else a.push(t.id)},checkSelected:function(){var e=this;setTimeout((function(){e.$refs.roleTable.clearSelection(),e.allRole.forEach((function(t){e.roles.includes(t.id)&&e.$refs.roleTable.toggleRowSelection(t,!0)}))}),50)},btnOk:function(){var e=this;return r()(n.a.mark((function t(){var a;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.roles.join(","),t.next=3,u.a.saveRoles.request({id:e.account.id,roleIds:a});case 3:e.$message.success("保存成功!"),e.cancel();case 5:case"end":return t.stop()}}),t)})))()},cancel:function(){this.query.pageNum=1,this.query.code=null,this.$emit("cancel")},clear:function(){this.query.pageNum=1,this.query.name=null,this.search()},search:function(){var e=this;return r()(n.a.mark((function t(){var a;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.d.list.request(e.query);case 2:a=t.sent,e.allRole=a.list,e.total=a.total,e.checkSelected();case 6:case"end":return t.stop()}}),t)})))()}},mounted:function(){},components:{ToolBar:i.a}},p=a(66),m=Object(p.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"account-dialog"},[a("el-dialog",{attrs:{title:"分配“"+e.account.username+"”的角色",visible:e.visible,"show-close":!1}},[a("ToolBar",[a("div",{staticStyle:{float:"left"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入角色名",size:"small",clearable:""},on:{clear:function(t){return e.clear()}},model:{value:e.query.name,callback:function(t){e.$set(e.query,"name",t)},expression:"query.name"}}),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"small"},on:{click:e.search}})],1)]),e._v(" "),a("el-table",{ref:"roleTable",staticStyle:{width:"100%"},attrs:{data:e.allRole,border:""},on:{select:e.select}},[a("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"角色描述"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{},[e._v("\n          "+e._s(t.row.remark?t.row.remark:"暂无描述")+"\n        ")])}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"text-align":"center","margin-top":"20px"},attrs:{background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"page-size":e.query.pageSize},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){return e.$set(e.query,"pageNum",t)},"update:current-page":function(t){return e.$set(e.query,"pageNum",t)}}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancel()}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.btnOk}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports,h=a(232),v={name:"AccountEdit",props:{visible:Boolean,account:[Object,Boolean],title:String},data:function(){return{enums:h.a,edit:!1,form:{id:null,username:null,password:null,repassword:null},btnLoading:!1,rules:{username:[{required:!0,message:"请输入用户名",trigger:["change","blur"]}],password:[{required:!0,message:"请输入密码",trigger:["change","blur"]}]}}},watch:{account:{handler:function(){this.account?(this.edit=!0,this.$Utils.copyProperties(this.account,this.form)):this.edit=!1},deep:!0}},methods:{btnOk:function(){var e=this;return r()(n.a.mark((function t(){var a;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.form.id?u.a.update:u.a.save,e.$refs.accountForm.validate((function(t){if(!t)return e.$message.error("表单填写有误"),!1;a.request(e.form).then((function(t){e.$message.success("操作成功"),e.$emit("val-change",e.form),e.btnLoading=!0,setTimeout((function(){e.btnLoading=!1}),1e3),e.$refs.accountForm.resetFields(),e.$Utils.resetProperties(e.form)}))}));case 2:case"end":return t.stop()}}),t)})))()},cancel:function(){var e=this;this.$emit("cancel"),setTimeout((function(){e.$refs.accountForm.resetFields(),e.$Utils.resetProperties(e.form)}),200)}},mounted:function(){},components:{}},f=Object(p.a)(v,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"account-dialog"},[a("el-dialog",{attrs:{title:e.title,visible:e.visible,"show-close":!1,width:"35%"}},[a("el-form",{ref:"accountForm",attrs:{model:e.form,rules:e.rules,"label-width":"85px",size:"small"}},[a("el-form-item",{attrs:{prop:"username",label:"用户名:",required:""}},[a("el-input",{attrs:{disabled:e.edit,placeholder:"请输入用户名","auto-complete":"off"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"==typeof t?t.trim():t)},expression:"form.username"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"password",label:"密码:",required:""}},[a("el-input",{attrs:{type:"password",placeholder:"请输入密码",autocomplete:"new-password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"==typeof t?t.trim():t)},expression:"form.password"}})],1),e._v(" "),e.edit?e._e():a("el-form-item",{attrs:{label:"确认密码:",required:""}},[a("el-input",{attrs:{type:"password",placeholder:"请输入确认密码",autocomplete:"new-password"},model:{value:e.form.repassword,callback:function(t){e.$set(e.form,"repassword","string"==typeof t?t.trim():t)},expression:"form.repassword"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.btnOk}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports,g={data:function(){return{enums:h.a,permission:c.a,chooseId:null,chooseData:null,query:{pageNum:1,pageSize:10},datas:[],total:null,showRoleDialog:{title:"",visible:!1,accountRoles:[]},showResourceDialog:{title:"",visible:!1,resources:[],defaultProps:{children:"children",label:"name"}},roleDialog:{visible:!1,account:{},roles:[]},accountDialog:{visible:!1,data:!1}}},methods:{choose:function(e){e&&(this.chooseId=e.id,this.chooseData=e)},search:function(){var e=this;return r()(n.a.mark((function t(){var a;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.list.request(e.query);case 2:a=t.sent,e.datas=a.list,e.total=a.total;case 5:case"end":return t.stop()}}),t)})))()},showResources:function(e){var t=this;return r()(n.a.mark((function a(){var o;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(o=t.showResourceDialog).title='"'+e.username+'" 的菜单&权限',o.resources=[],a.next=5,u.a.resources.request({id:e.id});case 5:o.resources=a.sent,o.visible=!0;case 7:case"end":return a.stop()}}),a)})))()},showRoles:function(e){var t=this;return r()(n.a.mark((function a(){var o;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(o=t.showRoleDialog).title='"'+e.username+'" 的角色信息',a.next=4,u.a.roles.request({id:e.id});case 4:o.accountRoles=a.sent,o.visible=!0;case 6:case"end":return a.stop()}}),a)})))()},changeStatus:function(e,t){var a=this;return r()(n.a.mark((function o(){return n.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,u.a.changeStatus.request({id:e,status:t});case 2:a.$message.success("操作成功"),a.search();case 4:case"end":return o.stop()}}),o)})))()},handlePageChange:function(e){this.query.pageNum=e,this.search()},roleEdit:function(){this.chooseId||this.$message.error("请选择账号"),this.roleDialog.visible=!0,console.log(this.chooseData),this.roleDialog.account=this.chooseData},editAccount:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.accountDialog.data=!e&&this.chooseData,this.accountDialog.visible=!0},cancel:function(){this.roleDialog.visible=!1,this.roleDialog.account=!1,this.search()},accountDialogCancel:function(){var e=this;this.accountDialog.visible=!1,setTimeout((function(){e.accountDialog.data=!1}),800)},valChange:function(){this.accountDialog.visible=!1,this.search()},deleteAccount:function(){var e=this;u.a.del.request({id:this.chooseId}).then((function(t){e.$message.success("删除成功"),e.search()}))}},mounted:function(){this.search()},components:{ToolBar:i.a,HelpHint:l.a,RoleEdit:m,AccountEdit:f}},b=Object(p.a)(g,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"role-list"},[a("ToolBar",[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:function(t){return e.editAccount(!0)}}},[e._v("添加")]),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{disabled:null==e.chooseId,type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.editAccount(!1)}}},[e._v("编辑")]),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.saveRoles.code,expression:"permission.saveRoles.code"}],attrs:{disabled:null==e.chooseId,type:"success",icon:"el-icon-setting",size:"mini"},on:{click:function(t){return e.roleEdit()}}},[e._v("角色分配")]),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.del.code,expression:"permission.del.code"}],attrs:{disabled:null==e.chooseId,type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.deleteAccount()}}},[e._v("删除")]),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"请输入账号名",size:"small",clearable:""},on:{clear:function(t){return e.search()}},model:{value:e.query.username,callback:function(t){e.$set(e.query,"username",t)},expression:"query.username"}}),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.search()}}})],1)],1),e._v(" "),a("el-table",{ref:"table",attrs:{data:e.datas,border:"","show-overflow-tooltip":""},on:{"current-change":e.choose}},[a("el-table-column",{attrs:{label:"选择",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.id},model:{value:e.chooseId,callback:function(t){e.chooseId=t},expression:"chooseId"}},[a("i")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名","min-width":"115"}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"95"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status==e.enums.accountStatus.DISABLE.value?a("el-tag",{attrs:{type:"danger"}},[e._v("禁用")]):a("el-tag",{attrs:{type:"success"}},[e._v("正常")]),e._v(" "),a("el-popover",{attrs:{placement:"bottom",width:"60",trigger:"click"}},[a("el-select",{attrs:{size:"mini",placeholder:"状态"},on:{change:function(a){return e.changeStatus(t.row.id,t.row.status)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}},e._l(e.enums.accountStatus,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "),a("el-link",{attrs:{slot:"reference",icon:"el-icon-edit"},slot:"reference"})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"115",prop:"createAccount",label:"创建账号"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"160",prop:"createTime",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"115",prop:"updateAccount",label:"更新账号"}}),e._v(" "),a("el-table-column",{attrs:{"min-width":"160",prop:"updateTime",label:"修改时间"}}),e._v(" "),a("el-table-column",{attrs:{label:"查看更多","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{type:"success"},on:{click:function(a){return e.showRoles(t.row)}}},[e._v("角色")]),e._v(" "),a("el-link",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{type:"info"},on:{click:function(a){return e.showResources(t.row)}}},[e._v("菜单&权限")])]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":"120",prop:"remark",label:"备注","show-overflow-tooltip":""}})],1),e._v(" "),a("el-pagination",{staticStyle:{"text-align":"center"},attrs:{background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"page-size":e.query.pageSize},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){return e.$set(e.query,"pageNum",t)},"update:current-page":function(t){return e.$set(e.query,"pageNum",t)}}}),e._v(" "),a("el-dialog",{attrs:{width:"500px",title:e.showRoleDialog.title,visible:e.showRoleDialog.visible},on:{"update:visible":function(t){return e.$set(e.showRoleDialog,"visible",t)}}},[a("el-table",{attrs:{border:"",data:e.showRoleDialog.accountRoles}},[a("el-table-column",{attrs:{property:"name",label:"角色名",width:"125"}}),e._v(" "),a("el-table-column",{attrs:{property:"createAccount",label:"分配账号",width:"125"}}),e._v(" "),a("el-table-column",{attrs:{property:"createTime",label:"分配时间"}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.showResourceDialog.title,visible:e.showResourceDialog.visible,width:"400px",height:"400px"},on:{"update:visible":function(t){return e.$set(e.showResourceDialog,"visible",t)}}},[a("el-tree",{staticStyle:{height:"50vh",overflow:"auto"},attrs:{data:e.showResourceDialog.resources,"node-key":"id",props:e.showResourceDialog.defaultProps,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,n=t.data;return a("span",{staticClass:"custom-tree-node"},[n.type==e.enums.ResourceTypeEnum.MENU.value?a("span",[e._v(e._s(o.label))]):e._e(),e._v(" "),n.type==e.enums.ResourceTypeEnum.PERMISSION.value?a("span",{staticStyle:{color:"#67c23a"}},[e._v(e._s(o.label))]):e._e()])}}])})],1),e._v(" "),a("RoleEdit",{attrs:{visible:e.roleDialog.visible,account:e.roleDialog.account},on:{cancel:function(t){return e.cancel()}}}),e._v(" "),a("AccountEdit",{attrs:{visible:e.accountDialog.visible,account:e.accountDialog.data},on:{cancel:function(t){return e.accountDialogCancel()},"val-change":function(t){return e.valChange()}}})],1)}),[],!1,null,null,null).exports}}]);