(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{190:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return a}));var s=r(18),n={resource:s.a.code("resource"),save:s.a.code("resource:save"),update:s.a.code("resource:update"),del:s.a.code("resource:delete")},o={role:s.a.code("role"),del:s.a.code("role:delete"),saveResources:s.a.code("role:saveResources")},a={account:s.a.code("account"),del:s.a.code("account:delete"),saveRoles:s.a.code("account:saveRoles")}},191:function(e,t,r){"use strict";var s={name:"HelpHint",props:{placement:{default:"top"},content:String},data:function(){return{}}},n=r(65),o=Object(n.a)(s,(function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("span",{staticStyle:{"margin-right":"8px"}},[this._t("default")],2),this._v(" "),t("el-tooltip",{attrs:{content:this.content,placement:this.placement}},[t("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"}})])],1)}),[],!1,null,null,null);t.a=o.exports},232:function(e,t,r){"use strict";r.r(t);var s,n,o,a,i=r(183),l=r.n(i),c=r(184),u=r.n(c),d=r(186),f=r(191),m=r(185),p={name:"RoleEdit",props:{visible:Boolean,data:[Object,Boolean],title:String},data:function(){return{form:{id:null,name:"",remark:""},btnLoading:!1}},watch:{data:{handler:function(){if(this.data)for(var e in this.form)this.form[e]=this.data[e];else for(var t in this.form)this.form[t]=""},deep:!0}},methods:{handleChange:function(){},btnOk:(s=u()(l.a.mark((function e(){var t,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.form,t=this.form.id?m.d.update:m.d.save,e.next=4,t.request(this.form);case 4:this.$emit("val-change",this.form),this.btnLoading=!0,setTimeout((function(){r.btnLoading=!1}),1e3);case 7:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},components:{}},h=r(65),v=Object(h.a)(p,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"role-dialog"},[r("el-dialog",{attrs:{title:e.title,visible:e.visible,"show-close":!1,width:"500px"}},[r("el-form",{attrs:{model:e.form,size:"small","label-width":"90px"}},[r("el-form-item",{attrs:{label:"角色名称:",required:""}},[r("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色描述:"}},[r("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入角色描述"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$emit("cancel")}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.btnOk}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports,b=r(190),y=r(188),g={props:{visible:Boolean,role:[Object,Boolean],defaultCheckedKeys:Array,resources:Array,title:String},data:function(){return{enums:y.a,btns:{menuList:{}},menus:[],defaultProps:{children:"children",label:"name"}}},methods:{getAllLeafIds:function(e){var t=[],r=!0,s=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var i=o.value;this.setLeafIds(i,t)}}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}return t},setLeafIds:function(e,t){if(null!==e.children){var r=!0,s=!1,n=void 0;try{for(var o,a=e.children[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var i=o.value;this.setLeafIds(i,t)}}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}}else t.push(e.id)},btnOk:function(){var e=u()(l.a.mark((function e(){var t,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$refs.menuTree.getCheckedKeys(),r=this.$refs.menuTree.getHalfCheckedKeys(),s=[].concat(t,r).join(","),e.next=5,m.d.saveResources.request({id:this.role.id,resourceIds:s});case 5:this.$message.success("保存成功!"),this.$emit("cancel");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},mounted:function(){}},k=Object(h.a)(g,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-dialog",{attrs:{title:"分配“"+e.role.name+"”菜单&权限",visible:e.visible,"show-close":!1,width:"400px",height:"400px"}},[r("el-tree",{ref:"menuTree",staticStyle:{height:"50vh",overflow:"auto"},attrs:{data:e.resources,"show-checkbox":"","node-key":"id","default-checked-keys":e.defaultCheckedKeys,props:e.defaultProps},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,n=t.data;return r("span",{staticClass:"custom-tree-node"},[n.type==e.enums.ResourceTypeEnum.MENU.value?r("span",[e._v(e._s(s.label))]):e._e(),e._v(" "),n.type==e.enums.ResourceTypeEnum.PERMISSION.value?r("span",{staticStyle:{color:"#67c23a"}},[e._v(e._s(s.label))]):e._e()])}}])}),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$emit("cancel")}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.btnOk}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports,x={data:function(){return{permission:b.c,dialogFormVisible:!1,currentEditPermissions:!1,params:{name:""},roles:[],resourceDialog:{visible:!1,role:{},resources:[],defaultCheckedKeys:[]},roleEdit:{title:"角色编辑",visible:!1,role:{}}}},methods:{searchRole:function(){for(var e=this.$refs.table.$el.querySelectorAll("tbody tr"),t=e[1].offsetHeight,r=!1,s=0;s<this.roleData.length;s++)this.params.name&&-1!=this.roleData[s].name.indexOf(this.params.name)?(e[s].style.backgroundColor="#85ce61",r||(scrollTo(0,s*t+66),r=!0)):e[s].style.backgroundColor="#fff"},roleEditChange:function(e){this.roleEdit.visible=!1,this.$message.success("修改成功！"),this.search()},editRole:function(e){this.roleEdit.data=e||!1,this.roleEdit.visible=!0},deleteRole:(a=u()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("此操作将删除 [".concat(t.name,"] 该角色，以及角色关联的用户和资源信息, 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return e.next=5,m.d.del.request({id:t.id});case 5:this.$message.success("删除成功！"),this.search(),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return a.apply(this,arguments)}),editResource:(o=u()(l.a.mark((function e(t){var r,s,n,o,a,i,c,u,d,f,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.c.list.request(null);case 2:return r=e.sent,this.resourceDialog.resources=r,e.next=6,m.d.rolePermissions.request({id:t.id});case 6:for(s=e.sent,n=s,o=[],a=this.getAllLeafIds(this.resourceDialog.resources),i=!0,c=!1,u=void 0,e.prev=13,d=a[Symbol.iterator]();!(i=(f=d.next()).done);i=!0)p=f.value,n.includes(p)&&o.push(p);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),c=!0,u=e.t0;case 21:e.prev=21,e.prev=22,i||null==d.return||d.return();case 24:if(e.prev=24,!c){e.next=27;break}throw u;case 27:return e.finish(24);case 28:return e.finish(21);case 29:this.resourceDialog.defaultCheckedKeys=o,this.resourceDialog.visible=!0,this.resourceDialog.role=t;case 32:case"end":return e.stop()}}),e,this,[[13,17,21,29],[22,,24,28]])}))),function(e){return o.apply(this,arguments)}),getAllLeafIds:function(e){var t=[],r=!0,s=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var i=o.value;this.setLeafIds(i,t)}}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}return t},setLeafIds:function(e,t){if(null!==e.children){var r=!0,s=!1,n=void 0;try{for(var o,a=e.children[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var i=o.value;this.setLeafIds(i,t)}}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}}else t.push(e.id)},cancelEditResources:function(){var e=this;this.resourceDialog.visible=!1,setTimeout((function(){e.resourceDialog.role=!1,e.resourceDialog.defaultCheckedKeys=[]}),10)},search:(n=u()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.d.list.request(null);case 2:t=e.sent,this.roles=t;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},mounted:function(){this.search()},components:{ToolBar:d.a,HelpHint:f.a,RoleEdit:v,ResourceEdit:k}},_=Object(h.a)(x,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"role-list"},[r("ToolBar",[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.role.code,expression:"permission.role.code"}],attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:function(t){return e.editRole(!1)}}},[e._v("添加")]),e._v(" "),r("div",{staticStyle:{float:"right"}},[r("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"请输入角色名称！",size:"small",clearable:""},on:{clear:e.searchRole},model:{value:e.params.name,callback:function(t){e.$set(e.params,"name",t)},expression:"params.name"}}),e._v(" "),r("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini"},on:{click:e.searchRole}})],1)],1),e._v(" "),r("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.roles,border:""}},[r("el-table-column",{attrs:{label:"序号",type:"index"}}),e._v(" "),r("el-table-column",{attrs:{prop:"name",label:"角色名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"remark",label:"描述","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),r("el-table-column",{attrs:{prop:"updateTime",label:"修改时间"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"350px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.role.code,expression:"permission.role.code"}],attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(r){return e.editRole(t.row)}}},[e._v("编辑")]),e._v(" "),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.saveResources.code,expression:"permission.saveResources.code"}],attrs:{type:"primary",icon:"el-icon-setting",size:"mini"},on:{click:function(r){return e.editResource(t.row)}}},[e._v("分配菜单&权限")]),e._v(" "),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.del.code,expression:"permission.del.code"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(r){return e.deleteRole(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),r("role-edit",{attrs:{title:e.roleEdit.title,visible:e.roleEdit.visible,data:e.roleEdit.data},on:{"val-change":e.roleEditChange,cancel:function(t){e.roleEdit.visible=!1}}}),e._v(" "),r("resource-edit",{attrs:{visible:e.resourceDialog.visible,role:e.resourceDialog.role,resources:e.resourceDialog.resources,defaultCheckedKeys:e.resourceDialog.defaultCheckedKeys},on:{cancel:function(t){return e.cancelEditResources()}}})],1)}),[],!1,null,null,null).exports;r.d(t,"default",(function(){return _}))}}]);