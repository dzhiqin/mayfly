(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{168:function(e,t,s){"use strict";var r,o=s(19),a=s.n(o),i=s(36),l=s(184),c=s.n(l),n=s(10),u=s(1);!function(e){e[e.SUCCESS=200]="SUCCESS",e[e.ERROR=400]="ERROR",e[e.PARAM_ERROR=405]="PARAM_ERROR",e[e.SERVER_ERROR=500]="SERVER_ERROR",e[e.NO_PERMISSION=501]="NO_PERMISSION"}(r||(r={}));const d=u.a.apiUrl;function h(e){a.a.Message.error(e)}const p=c.a.create({baseURL:d,timeout:5e3});function m(e,t){return e.replace(/\{\w+\}/g,e=>{let s=e.substring(1,e.length-1),r=t[s];return null!=r||null!=r?r:""})}function f(e,t,s){if(!t)throw new Error("请求url不能为空");-1!=t.indexOf("{")&&(t=m(t,s));const r={method:e,url:t},o=e.toLowerCase();return"post"===o||"put"===o?r.data=s:r.params=s,p.request(r).then(e=>e).catch(e=>(h(e.msg||e.message),Promise.reject(e)))}p.interceptors.request.use(e=>{const t=n.a.getToken();return t&&(e.headers.token=t),e},e=>(console.log(e),Promise.reject(e))),p.interceptors.response.use(e=>{const t=e.data;return t.code===r.NO_PERMISSION?(n.a.removeToken(),h("登录超时"),void setTimeout(()=>{i.a.push({path:"/login"})},1e3)):t.code===r.SUCCESS?t.data:Promise.reject(t)},e=>Promise.reject(e)),t.a={request:f,send:function(e,t){return f(e.method,e.url,t)},parseRestUrl:m,getApiUrl:function(e){return d+"?token="+n.a.getToken()}}},171:function(e,t,s){"use strict";var r=s(168);class o{constructor(e,t){this.url=e,this.method=t}setUrl(e){return this.url=e,this}setMethod(e){return this.method=e,this}getUrl(){return r.a.getApiUrl(this.url)}request(e){return r.a.send(this,e)}static create(e,t){return new o(e,t)}}t.a=o},175:function(e,t,s){"use strict";s.d(t,"c",(function(){return o})),s.d(t,"d",(function(){return a})),s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return l}));var r=s(171);const o={list:r.a.create("/sys/resources","get"),detail:r.a.create("/sys/resources/{id}","get"),save:r.a.create("/sys/resources","post"),update:r.a.create("/sys/resources/{id}","put"),del:r.a.create("/sys/resources/{id}","delete"),changeStatus:r.a.create("/sys/resources/{id}/{status}","put")},a={list:r.a.create("/sys/roles","get"),save:r.a.create("/sys/roles","post"),update:r.a.create("/sys/roles/{id}","put"),del:r.a.create("/sys/roles/{id}","delete"),roleResourceIds:r.a.create("/sys/roles/{id}/resourceIds","get"),roleResources:r.a.create("/sys/roles/{id}/resources","get"),saveResources:r.a.create("/sys/roles/{id}/resources","post")},i={list:r.a.create("/sys/accounts","get"),save:r.a.create("/sys/accounts","post"),update:r.a.create("/sys/accounts/{id}","put"),del:r.a.create("/sys/accounts/{id}","delete"),changeStatus:r.a.create("/sys/accounts/{id}/{status}","put"),roleIds:r.a.create("/sys/accounts/{id}/roleIds","get"),roles:r.a.create("/sys/accounts/{id}/roles","get"),resources:r.a.create("/sys/accounts/{id}/resources","get"),saveRoles:r.a.create("/sys/accounts/{id}/roles","post")},l={list:r.a.create("/sys/logs","get")}},178:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{add(e,t,s){return this[e]={label:t,value:s},this}getLabelByValue(e){if(null==e)return"";for(let t in this){let s=this[t];if(s&&s.value===e)return s.label}return""}}},183:function(e,t,s){"use strict";var r=s(178);t.a={ResourceTypeEnum:(new r.a).add("MENU","菜单",1).add("PERMISSION","权限",2),accountStatus:(new r.a).add("ENABLE","正常",1).add("DISABLE","禁用",0),logType:(new r.a).add("UPDATE","修改",2).add("DELETE","删除",3).add("SYS_LOG","系统",4).add("ERR_LOG","异常",5)}},231:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"c",(function(){return a})),s.d(t,"a",(function(){return i}));var r=s(10);const o={resource:r.a.code("resource"),save:r.a.code("resource:save"),update:r.a.code("resource:update"),del:r.a.code("resource:delete")},a={role:r.a.code("role"),del:r.a.code("role:delete"),saveResources:r.a.code("role:saveResources")},i={account:r.a.code("account"),changeStatus:r.a.code("account:changeStatus"),del:r.a.code("account:delete"),saveRoles:r.a.code("account:saveRoles")}},232:function(e,t,s){"use strict";var r={name:"HelpHint",props:{placement:{default:"top"},content:String},data:function(){return{}}},o=s(60),a=Object(o.a)(r,(function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("span",{staticStyle:{"margin-right":"8px"}},[this._t("default")],2),this._v(" "),t("el-tooltip",{attrs:{content:this.content,placement:this.placement}},[t("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"}})])],1)}),[],!1,null,null,null);t.a=a.exports},739:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return b}));var r=s(61),o=s(33),a=s(232),i=s(175);var l=(()=>{let e=class extends o.c{constructor(){super(...arguments),this.form={id:null,name:"",remark:""},this.btnLoading=!1}onRoleChange(){if(this.data)for(let e in this.form)this.form[e]=this.data[e];else for(let e in this.form)this.form[e]=""}handleChange(){}cancel(){this.$emit("update:visible",!1),this.$emit("cancel")}async btnOk(){this.form;let e=this.form.id?i.d.update:i.d.save;await e.request(this.form),this.$emit("val-change",this.form),this.cancel(),this.btnLoading=!0,setTimeout(()=>{this.btnLoading=!1},1e3)}};return Object(r.a)([Object(o.b)({default:"新增角色"})],e.prototype,"title",void 0),Object(r.a)([Object(o.b)({default:!1})],e.prototype,"visible",void 0),Object(r.a)([Object(o.b)()],e.prototype,"data",void 0),Object(r.a)([Object(o.d)("data",{deep:!0})],e.prototype,"onRoleChange",null),e=Object(r.a)([Object(o.a)({name:"RoleEdit"})],e),e})(),c=s(60),n=Object(c.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"role-dialog"},[s("el-dialog",{attrs:{title:e.title,visible:e.visible,"show-close":!1,width:"500px"}},[s("el-form",{attrs:{model:e.form,size:"small","label-width":"90px"}},[s("el-form-item",{attrs:{label:"角色名称:",required:""}},[s("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"角色描述:"}},[s("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入角色描述"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.btnOk}},[e._v("确 定")]),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancel()}}},[e._v("取 消")])],1)],1)],1)}),[],!1,null,null,null).exports,u=s(231),d=s(183);var h=(()=>{let e=class extends o.c{constructor(){super(...arguments),this.enums=d.a,this.defaultProps={children:"children",label:"name"}}getAllLeafIds(e){let t=[];for(let s of e)this.setLeafIds(s,t);return t}setLeafIds(e,t){if(null!==e.children)for(let s of e.children)this.setLeafIds(s,t);else t.push(e.id)}async btnOk(){const e=this.$refs.menuTree;let t=e.getCheckedKeys(),s=e.getHalfCheckedKeys(),r=[].concat(t,s).join(",");await i.d.saveResources.request({id:this.role.id,resourceIds:r}),this.$message.success("保存成功!"),this.$emit("cancel")}};return Object(r.a)([Object(o.b)()],e.prototype,"visible",void 0),Object(r.a)([Object(o.b)({default:{}})],e.prototype,"role",void 0),Object(r.a)([Object(o.b)()],e.prototype,"defaultCheckedKeys",void 0),Object(r.a)([Object(o.b)()],e.prototype,"resources",void 0),Object(r.a)([Object(o.b)({default:"编辑资源"})],e.prototype,"title",void 0),e=Object(r.a)([Object(o.a)({name:"ResourceEdit"})],e),e})(),p=Object(c.a)(h,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:"分配“"+e.role.name+"”菜单&权限",visible:e.visible,"show-close":!1,width:"400px",height:"400px"}},[s("el-tree",{ref:"menuTree",staticStyle:{height:"50vh",overflow:"auto"},attrs:{data:e.resources,"show-checkbox":"","node-key":"id","default-checked-keys":e.defaultCheckedKeys,props:e.defaultProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return s("span",{staticClass:"custom-tree-node"},[o.type==e.enums.ResourceTypeEnum.MENU.value?s("span",[e._v(e._s(r.label))]):e._e(),e._v(" "),o.type==e.enums.ResourceTypeEnum.PERMISSION.value?s("span",{staticStyle:{color:"#67c23a"}},[e._v(e._s(r.label))]):e._e()])}}])}),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.btnOk}},[e._v("确 定")]),e._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$emit("cancel")}}},[e._v("取 消")])],1)],1)],1)}),[],!1,null,null,null).exports;var m=(()=>{let e=class extends o.c{constructor(){super(...arguments),this.enums=d.a,this.defaultProps={children:"children",label:"resourceName"}}info(e){this.$alert('<strong style="margin-right: 18px">资源名称:</strong>'+e.resourceName+' <br/><strong style="margin-right: 18px">分配账号:</strong>'+e.creator+' <br/><strong style="margin-right: 18px">分配时间:</strong>'+e.createTime,"分配信息",{type:"info",dangerouslyUseHTMLString:!0,closeOnClickModal:!0,showConfirmButton:!1}).catch(e=>{})}closeDialog(){this.$emit("update:visible",!1),this.$emit("update:resources",[])}};return Object(r.a)([Object(o.b)()],e.prototype,"visible",void 0),Object(r.a)([Object(o.b)()],e.prototype,"resources",void 0),Object(r.a)([Object(o.b)()],e.prototype,"title",void 0),e=Object(r.a)([Object(o.a)({name:"ShowResource"})],e),e})(),f=Object(c.a)(m,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:e.title,visible:e.visible,width:"400px",height:"400px"},on:{close:e.closeDialog}},[s("el-tree",{staticStyle:{height:"50vh",overflow:"auto"},attrs:{data:e.resources,"node-key":"id",props:e.defaultProps,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return s("span",{staticClass:"custom-tree-node"},[o.type==e.enums.ResourceTypeEnum.MENU.value?s("span",[e._v(e._s(r.label))]):e._e(),e._v(" "),o.type==e.enums.ResourceTypeEnum.PERMISSION.value?s("span",{staticStyle:{color:"#67c23a"}},[e._v(e._s(r.label))]):e._e(),e._v(" "),s("el-link",{staticStyle:{"margin-left":"25px"},attrs:{icon:"el-icon-view",type:"info",underline:!1},on:{click:function(t){return e.info(o)}}})],1)}}])})],1)],1)}),[],!1,null,null,null).exports;var v=(()=>{let e=class extends o.c{constructor(){super(...arguments),this.permission=u.c,this.dialogFormVisible=!1,this.currentEditPermissions=!1,this.query={pageNum:1,pageSize:10,name:null},this.total=0,this.roles=[],this.chooseId=null,this.chooseData=null,this.resourceDialog={visible:!1,role:{},resources:[],defaultCheckedKeys:[]},this.roleEdit={title:"角色编辑",visible:!1,role:{}},this.showResourceDialog={visible:!1,resources:[],title:""}}mounted(){this.search()}async search(){let e=await i.d.list.request(this.query);this.roles=e.list,this.total=e.total}handlePageChange(e){this.query.pageNum=e,this.search()}choose(e){e&&(this.chooseId=e.id,this.chooseData=e)}roleEditChange(e){this.$message.success("修改成功！"),this.search()}editRole(e){this.roleEdit.role=e||!1,this.roleEdit.visible=!0}async deleteRole(e){try{await this.$confirm(`此操作将删除 [${e.name}] 该角色，以及与该角色有关的账号角色关联信息和资源角色关联信息, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await i.d.del.request({id:e.id}),this.$message.success("删除成功！"),this.search()}catch(e){}}async showResources(e){this.showResourceDialog.resources=await i.d.roleResources.request({id:e.id}),this.showResourceDialog.title='"'+e.name+'"的菜单&权限',this.showResourceDialog.visible=!0}closeShowResourceDialog(){this.showResourceDialog.visible=!1,this.showResourceDialog.resources=[]}async editResource(e){let t=await i.c.list.request(null);this.resourceDialog.resources=t;let s=await i.d.roleResourceIds.request({id:e.id}),r=[],o=this.getAllLeafIds(this.resourceDialog.resources);for(let e of o)s.includes(e)&&r.push(e);this.resourceDialog.defaultCheckedKeys=r,this.resourceDialog.visible=!0,this.resourceDialog.role=e}getAllLeafIds(e){let t=[];for(let s of e)this.setLeafIds(s,t);return t}setLeafIds(e,t){if(null!==e.children)for(let s of e.children)this.setLeafIds(s,t);else t.push(e.id)}cancelEditResources(){this.resourceDialog.visible=!1,setTimeout(()=>{this.resourceDialog.role=!1,this.resourceDialog.defaultCheckedKeys=[]},10)}};return e=Object(r.a)([Object(o.a)({name:"RoleList",components:{HelpHint:a.a,RoleEdit:n,ResourceEdit:p,ShowResource:f}})],e),e})(),b=Object(c.a)(v,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"role-list"},[s("div",{staticClass:"toolbar"},[s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.role.code,expression:"permission.role.code"}],attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:function(t){return e.editRole(!1)}}},[e._v("添加")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.role.code,expression:"permission.role.code"}],attrs:{disabled:null==e.chooseId,type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.editRole(e.chooseData)}}},[e._v("编辑")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.saveResources.code,expression:"permission.saveResources.code"}],attrs:{disabled:null==e.chooseId,type:"success",icon:"el-icon-setting",size:"mini"},on:{click:function(t){return e.editResource(e.chooseData)}}},[e._v("分配菜单&权限")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.del.code,expression:"permission.del.code"}],attrs:{disabled:null==e.chooseId,type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.deleteRole(e.chooseData)}}},[e._v("删除")]),e._v(" "),s("div",{staticStyle:{float:"right"}},[s("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"请输入角色名称！",size:"small",clearable:""},on:{clear:e.search},model:{value:e.query.name,callback:function(t){e.$set(e.query,"name",t)},expression:"query.name"}}),e._v(" "),s("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini"},on:{click:e.search}})],1)],1),e._v(" "),s("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.roles,border:""},on:{"current-change":e.choose}},[s("el-table-column",{attrs:{label:"选择",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-radio",{attrs:{label:t.row.id},model:{value:e.chooseId,callback:function(t){e.chooseId=t},expression:"chooseId"}},[s("i")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"角色名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"remark",label:"描述","min-width":"180px","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),e._v(" "),s("el-table-column",{attrs:{prop:"updateTime",label:"修改时间"}}),e._v(" "),s("el-table-column",{attrs:{label:"查看更多","min-width":"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.role.code,expression:"permission.role.code"}],attrs:{type:"info"},on:{click:function(s){return e.showResources(t.row)}}},[e._v("菜单&权限")])]}}])})],1),e._v(" "),s("el-pagination",{staticStyle:{"text-align":"center"},attrs:{background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"page-size":e.query.pageSize},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){return e.$set(e.query,"pageNum",t)},"update:current-page":function(t){return e.$set(e.query,"pageNum",t)}}}),e._v(" "),s("role-edit",{attrs:{title:e.roleEdit.title,visible:e.roleEdit.visible,data:e.roleEdit.role},on:{"update:visible":function(t){return e.$set(e.roleEdit,"visible",t)},"val-change":e.roleEditChange}}),e._v(" "),s("resource-edit",{attrs:{visible:e.resourceDialog.visible,role:e.resourceDialog.role,resources:e.resourceDialog.resources,defaultCheckedKeys:e.resourceDialog.defaultCheckedKeys},on:{cancel:function(t){return e.cancelEditResources()}}}),e._v(" "),s("show-resource",{attrs:{visible:e.showResourceDialog.visible,title:e.showResourceDialog.title,resources:e.showResourceDialog.resources},on:{"update:visible":function(t){return e.$set(e.showResourceDialog,"visible",t)},"update:resources":function(t){return e.$set(e.showResourceDialog,"resources",t)}}})],1)}),[],!1,null,null,null).exports}}]);