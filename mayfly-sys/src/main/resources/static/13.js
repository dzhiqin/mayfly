(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{161:function(e,t,i){var n=i(36),a=i(176);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var s={insert:"head",singleton:!1};n(a,s);e.exports=a.locals||{}},171:function(e,t,i){"use strict";i(175);var n=i(61),a=Object(n.a)({},(function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"toolbar"},[this._t("default")],2)}),[],!1,null,null,null);t.a=a.exports},175:function(e,t,i){"use strict";var n=i(161);i.n(n).a},176:function(e,t,i){(t=i(37)(!1)).push([e.i,"\n.toolbar {\n  width: 100%;\n  padding: 8px;\n  background-color: #ffffff;\n  overflow: hidden;\n  line-height: 32px;\n  border: 1px solid #e6ebf5;\n}\n",""]),e.exports=t},177:function(e,t,i){"use strict";var n=i(6),a=i.n(n),s=i(11),l=i.n(s),r=i(182),o=function(){function e(t){a()(this,e),this.url=t}return l()(e,[{key:"url",value:function(e){return this.url=e,this}},{key:"method",value:function(e){return this.method=e,this}},{key:"getUrl",value:function(){return r.a.getApiUrl(this.url)}},{key:"request",value:function(e){return r.a.send(this,e)}}],[{key:"url",value:function(t){return new e(t)}}]),e}();t.a=o},219:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return s})),i.d(t,"b",(function(){return l}));var n=i(12),a={machine:n.a.code("machine"),del:n.a.code("machine:delete"),machineFile:n.a.code("machineFile"),rmFile:n.a.code("machineFile:rm"),uploadFile:n.a.code("machineFile:upload"),updateFileContent:n.a.code("machineFile:updateFileContent"),addConf:n.a.code("machineFile:addConf")},s={redis:n.a.code("redis")},l={redisKey:n.a.code("redis:key"),del:n.a.code("redis:key:delete")}},220:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return l}));var n=i(177),a={list:n.a.url("/devops/machines").method("get"),save:n.a.url("/devops/machines").method("post"),update:n.a.url("/devops/machines/{id}").method("put"),del:n.a.url("/devops/machines/{id}").method("delete"),files:n.a.url("/devops/machines/{id}/files").method("get"),lsFile:n.a.url("/devops/machines/files/{fileId}/ls").method("get"),rmFile:n.a.url("/devops/machines/files/{fileId}/rm").method("delete"),uploadFile:n.a.url("/devops/machines/files/upload"),fileContent:n.a.url("/devops/machines/files/{fileId}/cat").method("get"),updateFileContent:n.a.url("/devops/machines/files/{id}").method("put"),addConf:n.a.url("/devops/machines/{machineId}/files").method("post"),delConf:n.a.url("/devops/machines/files/{id}").method("delete")},s={list:n.a.url("/devops/redis").method("get"),info:n.a.url("/devops/redis/{id}/info").method("get"),del:n.a.url("/devops/redis/{id}").method("delete"),save:n.a.url("/devops/redis").method("post"),update:n.a.url("/devops/redis/{id}").method("put")},l={scan:n.a.url("/devops/redis/{cluster}/{id}/scan").method("get"),value:n.a.url("/devops/redis/{cluster}/{id}/value").method("get"),update:n.a.url("/devops/redis/{cluster}/{id}").method("put"),del:n.a.url("/devops/redis/{cluster}/{id}").method("delete")}},307:function(e,t,i){"use strict";var n=i(190);t.a={FileTypeEnum:(new n.a).add("DIRECTORY","目录",1).add("FILE","文件",2),ValueTypeEnum:(new n.a).add("string","string",1).add("set","set",2)}},758:function(e,t,i){"use strict";i.r(t);var n=i(173),a=i.n(n),s=i(174),l=i.n(s),r=i(171),o=(i(182),i(307)),u=i(219),c={name:"valueDialog",props:{visible:Boolean,keyValue:[Object],title:String},data:function(){return{}}},d=i(61),p=Object(d.a)(c,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:e.keyValue.key,visible:e.visible,width:"650px"},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",[i("el-form-item",[i("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:15},autocomplete:"off"},model:{value:e.keyValue.value,callback:function(t){e.$set(e.keyValue,"value",t)},expression:"keyValue.value"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.$emit("cancel")}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("确 定")])],1)],1)}),[],!1,null,null,null).exports,m=i(220),v={data:function(){return{permission:u.b,loading:!0,enums:o.a,cluster:this.$route.params.cluster,redis:{id:"",info:"",conf:""},scanParam:{match:null,count:12,cursor:null,prevCursor:null},valueDialog:{visible:!1,value:{}},keys:[],dbsize:0}},methods:{scan:function(){var e=this;this.loading=!0,this.scanParam.id=0==this.cluster?this.redis.id:this.cluster,this.scanParam.cluster=0==this.cluster?0:1,m.c.scan.request(this.scanParam).then((function(t){e.keys=t.keys,e.dbsize=t.dbsize,e.scanParam.cursor=t.cursor,e.loading=!1}))},search:function(){this.scanParam.cursor=null,this.scan()},handlePageChange:function(e){this.scanParam.pageNum=e,this.scan()},clear:function(){this.scanParam.match=null,this.scanParam.cursor=null,this.scan()},getValue:function(e){var t=this;return l()(a.a.mark((function i(){var n,s;return a.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n=0==t.cluster?t.redis.id:t.cluster,i.next=3,m.c.value.request({cluster:t.cluster,key:e,id:n});case 3:s=i.sent,t.valueDialog.value=s,t.valueDialog.visible=!0;case 6:case"end":return i.stop()}}),i)})))()},closeValueDialog:function(){this.valueDialog.visible=!1,this.valueDialog.value={}},update:function(e){},del:function(e){var t=this;this.$confirm("此操作将删除对应的key , 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var i=0==t.cluster?t.redis.id:t.cluster;m.c.del.request({cluster:t.cluster,key:e,id:i}).then((function(e){t.$message.success("删除成功！"),t.scan()}))})).catch((function(e){}))},ttlConveter:function(e){if(-1===e)return"永久";e||(e=0);var t=parseInt(e),i=0,n=0,a=0;t>60&&(i=parseInt(t/60),t=parseInt(t%60),i>60&&(n=parseInt(i/60),i=parseInt(i%60),n>24&&(a=parseInt(n/24),n=parseInt(n%24))));var s=t+"s";return i>0&&(s=i+"m:"+s),n>0&&(s=n+"h:"+s),a>0&&(s=a+"d:"+s),s}},mounted:function(){this.redis.id=this.$route.params.id,this.scan()},components:{ToolBar:r.a,ValueDialog:p}},h=Object(d.a)(v,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("ToolBar",[i("div",{staticStyle:{float:"left"}},[i("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入key",size:"mini",clearable:""},on:{clear:function(t){return e.clear()}},model:{value:e.scanParam.match,callback:function(t){e.$set(e.scanParam,"match",t)},expression:"scanParam.match"}}),e._v(" "),i("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini",plain:""},on:{click:function(t){return e.search()}}},[e._v("搜索")]),e._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",plain:""},on:{click:function(t){return e.save(!1)}}},[e._v("添加")]),e._v(" "),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini",plain:""},on:{click:function(t){return e.scan()}}},[e._v("换一批")])],1),e._v(" "),i("div",{staticStyle:{float:"right"}},[i("span",[e._v("keys:"+e._s(e.dbsize))])])]),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{cursor:"pointer"},attrs:{data:e.keys,border:"",stripe:"","highlight-current-row":!0}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"key",label:"key"}}),e._v(" "),i("el-table-column",{attrs:{prop:"type",label:"type",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.enums.ValueTypeEnum.getLabelByValue(t.row.type))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"ttl",label:"ttl(过期时间)",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.ttlConveter(t.row.ttl))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.redisKey.code,expression:"permission.redisKey.code"}],attrs:{type:"success",icon:"el-icon-search",size:"mini",plain:""},on:{click:function(i){return e.getValue(t.row.key)}}},[e._v("查看")]),e._v(" "),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.redisKey.code,expression:"permission.redisKey.code"}],attrs:{type:"primary",icon:"el-icon-edit",size:"mini",plain:""},on:{click:function(i){return e.update(t.row.key)}}},[e._v("修改")]),e._v(" "),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.del.code,expression:"permission.del.code"}],attrs:{type:"danger",size:"mini",icon:"el-icon-delete",plain:""},on:{click:function(i){return e.del(t.row.key)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("div",{staticStyle:{"text-align":"center","margin-top":"10px"}}),e._v(" "),i("value-dialog",{attrs:{visible:e.valueDialog.visible,keyValue:e.valueDialog.value},on:{cancel:e.closeValueDialog}})],1)}),[],!1,null,null,null);t.default=h.exports}}]);