(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{168:function(e,t,s){"use strict";var i,a=s(19),r=s.n(a),n=s(36),l=s(184),c=s.n(l),o=s(10),u=s(1);!function(e){e[e.SUCCESS=200]="SUCCESS",e[e.ERROR=400]="ERROR",e[e.PARAM_ERROR=405]="PARAM_ERROR",e[e.SERVER_ERROR=500]="SERVER_ERROR",e[e.NO_PERMISSION=501]="NO_PERMISSION"}(i||(i={}));const d=u.a.apiUrl;function p(e){r.a.Message.error(e)}const h=c.a.create({baseURL:d,timeout:5e3});function m(e,t){return e.replace(/\{\w+\}/g,e=>{let s=e.substring(1,e.length-1),i=t[s];return null!=i||null!=i?i:""})}function v(e,t,s){if(!t)throw new Error("请求url不能为空");-1!=t.indexOf("{")&&(t=m(t,s));const i={method:e,url:t},a=e.toLowerCase();return"post"===a||"put"===a?i.data=s:i.params=s,h.request(i).then(e=>e).catch(e=>(p(e.msg||e.message),Promise.reject(e)))}h.interceptors.request.use(e=>{const t=o.a.getToken();return t&&(e.headers.token=t),e},e=>(console.log(e),Promise.reject(e))),h.interceptors.response.use(e=>{const t=e.data;return t.code===i.NO_PERMISSION?(o.a.removeToken(),p("登录超时"),void setTimeout(()=>{n.a.push({path:"/login"})},1e3)):t.code===i.SUCCESS?t.data:Promise.reject(t)},e=>Promise.reject(e)),t.a={request:v,send:function(e,t){return v(e.method,e.url,t)},parseRestUrl:m,getApiUrl:function(e){return d+"?token="+o.a.getToken()}}},171:function(e,t,s){"use strict";var i=s(168);class a{constructor(e,t){this.url=e,this.method=t}setUrl(e){return this.url=e,this}setMethod(e){return this.method=e,this}getUrl(){return i.a.getApiUrl(this.url)}request(e){return i.a.send(this,e)}static create(e,t){return new a(e,t)}}t.a=a},178:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{add(e,t,s){return this[e]={label:t,value:s},this}getLabelByValue(e){if(null==e)return"";for(let t in this){let s=this[t];if(s&&s.value===e)return s.label}return""}}},213:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return n}));var i=s(10);const a={machine:i.a.code("machine"),del:i.a.code("machine:delete"),machineFile:i.a.code("machineFile"),rmFile:i.a.code("machineFile:rm"),uploadFile:i.a.code("machineFile:upload"),updateFileContent:i.a.code("machineFile:updateFileContent"),addConf:i.a.code("machineFile:addConf")},r={redis:i.a.code("redis")},n={redisKey:i.a.code("redis:key"),del:i.a.code("redis:key:delete")}},214:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return r})),s.d(t,"c",(function(){return n}));var i=s(171);const a={list:i.a.create("/devops/machines","get"),save:i.a.create("/devops/machines","post"),update:i.a.create("/devops/machines/{id}","put"),del:i.a.create("/devops/machines/{id}","delete"),files:i.a.create("/devops/machines/{id}/files","get"),lsFile:i.a.create("/devops/machines/files/{fileId}/ls","get"),rmFile:i.a.create("/devops/machines/files/{fileId}/rm","delete"),uploadFile:i.a.create("/devops/machines/files/upload","post"),fileContent:i.a.create("/devops/machines/files/{fileId}/cat","get"),updateFileContent:i.a.create("/devops/machines/files/{id}","put"),addConf:i.a.create("/devops/machines/{machineId}/files","post"),delConf:i.a.create("/devops/machines/files/{id}","delete")},r={list:i.a.create("/devops/redis","get"),info:i.a.create("/devops/redis/{id}/info","get"),del:i.a.create("/devops/redis/{id}","delete"),save:i.a.create("/devops/redis","post"),update:i.a.create("/devops/redis/{id}","put")},n={scan:i.a.create("/devops/redis/{cluster}/{id}/scan","get"),value:i.a.create("/devops/redis/{cluster}/{id}/value","get"),update:i.a.create("/devops/redis/{cluster}/{id}","put"),del:i.a.create("/devops/redis/{cluster}/{id}","delete")}},300:function(e,t,s){"use strict";var i=s(178);t.a={FileTypeEnum:(new i.a).add("DIRECTORY","目录",1).add("FILE","文件",2),ValueTypeEnum:(new i.a).add("string","string",1).add("set","set",2)}},745:function(e,t,s){"use strict";s.r(t);var i=s(61),a=s(33),r=s(300),n=s(213);var l=(()=>{let e=class extends a.c{cancel(){this.$emit("update:visible",!1),this.$emit("cancel")}};return Object(i.a)([Object(a.b)()],e.prototype,"visible",void 0),Object(i.a)([Object(a.b)()],e.prototype,"keyValue",void 0),Object(i.a)([Object(a.b)()],e.prototype,"title",void 0),e=Object(i.a)([Object(a.a)({name:"ValueDialog"})],e),e})(),c=s(60),o=Object(c.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:e.keyValue.key,visible:e.visible,"show-close":!1,width:"650px"}},[s("el-form",[s("el-form-item",[s("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:15},autocomplete:"off"},model:{value:e.keyValue.value,callback:function(t){e.$set(e.keyValue,"value",t)},expression:"keyValue.value"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("确 定")]),e._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cancel()}}},[e._v("取 消")])],1)],1)}),[],!1,null,null,null).exports,u=s(214);var d=(()=>{let e=class extends a.c{constructor(){super(...arguments),this.permission=n.b,this.loading=!0,this.enums=r.a,this.cluster=0,this.redis={id:0,info:"",conf:""},this.scanParam={id:0,cluster:0,match:null,count:12,cursor:null,prevCursor:null},this.valueDialog={visible:!1,value:{}},this.keys=[],this.dbsize=0}mounted(){this.redis.id=parseInt(this.$route.params.id),this.cluster=parseInt(this.$route.params.cluster),this.scan()}scan(){this.loading=!0,this.scanParam.id=0==this.cluster?this.redis.id:this.cluster,this.scanParam.cluster=0==this.cluster?0:1,u.c.scan.request(this.scanParam).then(e=>{this.keys=e.keys,this.dbsize=e.dbsize,this.scanParam.cursor=e.cursor,this.loading=!1})}search(){this.scanParam.cursor=null,this.scan()}clear(){this.scanParam.match=null,this.scanParam.cursor=null,this.scan()}async getValue(e){let t=0==this.cluster?this.redis.id:this.cluster,s=await u.c.value.request({cluster:this.cluster,key:e,id:t});this.valueDialog.value=s,this.valueDialog.visible=!0}update(e){}del(e){this.$confirm("此操作将删除对应的key , 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t=0==this.cluster?this.redis.id:this.cluster;u.c.del.request({cluster:this.cluster,key:e,id:t}).then(e=>{this.$message.success("删除成功！"),this.scan()})}).catch(e=>{})}ttlConveter(e){if(-1===e)return"永久";e||(e=0);let t=parseInt(e),s=0,i=0,a=0;t>60&&(s=parseInt(t/60+""),t%=60,s>60&&(i=parseInt(s/60+""),s%=60,i>24&&(a=parseInt(i/24+""),i%=24)));let r=t+"s";return s>0&&(r=s+"m:"+r),i>0&&(r=i+"h:"+r),a>0&&(r=a+"d:"+r),r}};return e=Object(i.a)([Object(a.a)({name:"RedisOperation",components:{ValueDialog:o}})],e),e})(),p=Object(c.a)(d,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"toolbar"},[s("div",{staticStyle:{float:"left"}},[s("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入key",size:"mini",clearable:""},on:{clear:function(t){return e.clear()}},model:{value:e.scanParam.match,callback:function(t){e.$set(e.scanParam,"match",t)},expression:"scanParam.match"}}),e._v(" "),s("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini",plain:""},on:{click:function(t){return e.search()}}},[e._v("搜索")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",plain:""},on:{click:function(t){return e.save(!1)}}},[e._v("添加")]),e._v(" "),s("el-button",{attrs:{icon:"el-icon-refresh",size:"mini",plain:""},on:{click:function(t){return e.scan()}}},[e._v("换一批")])],1),e._v(" "),s("div",{staticStyle:{float:"right"}},[s("span",[e._v("keys:"+e._s(e.dbsize))])])]),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{cursor:"pointer"},attrs:{data:e.keys,border:"",stripe:"","highlight-current-row":!0}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"key",label:"key"}}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"type",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.enums.ValueTypeEnum.getLabelByValue(t.row.type)))]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"ttl",label:"ttl(过期时间)",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.ttlConveter(t.row.ttl)))]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.redisKey.code,expression:"permission.redisKey.code"}],attrs:{type:"success",icon:"el-icon-search",size:"mini",plain:""},on:{click:function(s){return e.getValue(t.row.key)}}},[e._v("查看")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.redisKey.code,expression:"permission.redisKey.code"}],attrs:{type:"primary",icon:"el-icon-edit",size:"mini",plain:""},on:{click:function(s){return e.update(t.row.key)}}},[e._v("修改")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.del.code,expression:"permission.del.code"}],attrs:{type:"danger",size:"mini",icon:"el-icon-delete",plain:""},on:{click:function(s){return e.del(t.row.key)}}},[e._v("删除")])]}}])})],1),e._v(" "),s("div",{staticStyle:{"text-align":"center","margin-top":"10px"}}),e._v(" "),s("value-dialog",{attrs:{visible:e.valueDialog.visible,keyValue:e.valueDialog.value},on:{"update:visible":function(t){return e.$set(e.valueDialog,"visible",t)}}})],1)}),[],!1,null,null,null);t.default=p.exports}}]);