(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{168:function(e,t,s){"use strict";var a,o=s(19),r=s.n(o),i=s(36),l=s(184),n=s.n(l),c=s(10),u=s(1);!function(e){e[e.SUCCESS=200]="SUCCESS",e[e.ERROR=400]="ERROR",e[e.PARAM_ERROR=405]="PARAM_ERROR",e[e.SERVER_ERROR=500]="SERVER_ERROR",e[e.NO_PERMISSION=501]="NO_PERMISSION"}(a||(a={}));const d=u.a.apiUrl;function p(e){r.a.Message.error(e)}const h=n.a.create({baseURL:d,timeout:5e3});function m(e,t){return e.replace(/\{\w+\}/g,e=>{let s=e.substring(1,e.length-1),a=t[s];return null!=a||null!=a?a:""})}function v(e,t,s){if(!t)throw new Error("请求url不能为空");-1!=t.indexOf("{")&&(t=m(t,s));const a={method:e,url:t},o=e.toLowerCase();return"post"===o||"put"===o?a.data=s:a.params=s,h.request(a).then(e=>e).catch(e=>(p(e.msg||e.message),Promise.reject(e)))}h.interceptors.request.use(e=>{const t=c.a.getToken();return t&&(e.headers.token=t),e},e=>(console.log(e),Promise.reject(e))),h.interceptors.response.use(e=>{const t=e.data;return t.code===a.NO_PERMISSION?(c.a.removeToken(),p("登录超时"),void setTimeout(()=>{i.a.push({path:"/login"})},1e3)):t.code===a.SUCCESS?t.data:Promise.reject(t)},e=>Promise.reject(e)),t.a={request:v,send:function(e,t){return v(e.method,e.url,t)},parseRestUrl:m,getApiUrl:function(e){return d+"?token="+c.a.getToken()}}},171:function(e,t,s){"use strict";var a=s(168);class o{constructor(e,t){this.url=e,this.method=t}setUrl(e){return this.url=e,this}setMethod(e){return this.method=e,this}getUrl(){return a.a.getApiUrl(this.url)}request(e){return a.a.send(this,e)}static create(e,t){return new o(e,t)}}t.a=o},175:function(e,t,s){"use strict";s.d(t,"c",(function(){return o})),s.d(t,"d",(function(){return r})),s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return l}));var a=s(171);const o={list:a.a.create("/sys/resources","get"),detail:a.a.create("/sys/resources/{id}","get"),save:a.a.create("/sys/resources","post"),update:a.a.create("/sys/resources/{id}","put"),del:a.a.create("/sys/resources/{id}","delete"),changeStatus:a.a.create("/sys/resources/{id}/{status}","put")},r={list:a.a.create("/sys/roles","get"),save:a.a.create("/sys/roles","post"),update:a.a.create("/sys/roles/{id}","put"),del:a.a.create("/sys/roles/{id}","delete"),roleResourceIds:a.a.create("/sys/roles/{id}/resourceIds","get"),roleResources:a.a.create("/sys/roles/{id}/resources","get"),saveResources:a.a.create("/sys/roles/{id}/resources","post")},i={list:a.a.create("/sys/accounts","get"),save:a.a.create("/sys/accounts","post"),update:a.a.create("/sys/accounts/{id}","put"),del:a.a.create("/sys/accounts/{id}","delete"),changeStatus:a.a.create("/sys/accounts/{id}/{status}","put"),roleIds:a.a.create("/sys/accounts/{id}/roleIds","get"),roles:a.a.create("/sys/accounts/{id}/roles","get"),resources:a.a.create("/sys/accounts/{id}/resources","get"),saveRoles:a.a.create("/sys/accounts/{id}/roles","post")},l={list:a.a.create("/sys/logs","get")}},178:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));class a{add(e,t,s){return this[e]={label:t,value:s},this}getLabelByValue(e){if(null==e)return"";for(let t in this){let s=this[t];if(s&&s.value===e)return s.label}return""}}},183:function(e,t,s){"use strict";var a=s(178);t.a={ResourceTypeEnum:(new a.a).add("MENU","菜单",1).add("PERMISSION","权限",2),accountStatus:(new a.a).add("ENABLE","正常",1).add("DISABLE","禁用",0),logType:(new a.a).add("UPDATE","修改",2).add("DELETE","删除",3).add("SYS_LOG","系统",4).add("ERR_LOG","异常",5)}},231:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"c",(function(){return r})),s.d(t,"a",(function(){return i}));var a=s(10);const o={resource:a.a.code("resource"),save:a.a.code("resource:save"),update:a.a.code("resource:update"),del:a.a.code("resource:delete")},r={role:a.a.code("role"),del:a.a.code("role:delete"),saveResources:a.a.code("role:saveResources")},i={account:a.a.code("account"),changeStatus:a.a.code("account:changeStatus"),del:a.a.code("account:delete"),saveRoles:a.a.code("account:saveRoles")}},232:function(e,t,s){"use strict";var a={name:"HelpHint",props:{placement:{default:"top"},content:String},data:function(){return{}}},o=s(60),r=Object(o.a)(a,(function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("span",{staticStyle:{"margin-right":"8px"}},[this._t("default")],2),this._v(" "),t("el-tooltip",{attrs:{content:this.content,placement:this.placement}},[t("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"}})])],1)}),[],!1,null,null,null);t.a=r.exports},740:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return v}));var a=s(61),o=s(33),r=s(232),i=s(231),l=s(175);var n=(()=>{let e=class extends o.c{constructor(){super(...arguments),this.btnLoading=!1,this.allRole=[],this.roles=[],this.query={name:null,pageNum:1,pageSize:5},this.total=0}onDataChange(){null!==this.account&&l.a.roleIds.request({id:this.account.id}).then(e=>{this.roles=e,this.search()})}handlePageChange(){this.search()}select(e,t){let s=this.roles;if(s.includes(t.id))for(let e=0;e<s.length;e++){if(s[e]===t.id){s.splice(e,1);break}}else s.push(t.id)}checkSelected(){setTimeout(()=>{const e=this.$refs.roleTable;e.clearSelection(),this.allRole.forEach(t=>{this.roles.includes(t.id)&&e.toggleRowSelection(t,!0)})},50)}async btnOk(){let e=this.roles.join(",");await l.a.saveRoles.request({id:this.account.id,roleIds:e}),this.$message.success("保存成功!"),this.cancel()}cancel(){this.query.pageNum=1,this.query.name=null,this.$emit("cancel")}clear(){this.query.pageNum=1,this.query.name=null,this.search()}async search(){let e=await l.d.list.request(this.query);this.allRole=e.list,this.total=e.total,this.checkSelected()}};return Object(a.a)([Object(o.b)()],e.prototype,"visible",void 0),Object(a.a)([Object(o.b)()],e.prototype,"account",void 0),Object(a.a)([Object(o.d)("account",{deep:!0})],e.prototype,"onDataChange",null),e=Object(a.a)([Object(o.a)({name:"RoleEdit"})],e),e})(),c=s(60),u=Object(c.a)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"account-dialog"},[s("el-dialog",{attrs:{title:null==e.account?"":"分配“"+e.account.username+"”的角色",visible:e.visible,"show-close":!1}},[s("div",{staticClass:"toolbar"},[s("div",{staticStyle:{float:"left"}},[s("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入角色名",size:"small",clearable:""},on:{clear:function(t){return e.clear()}},model:{value:e.query.name,callback:function(t){e.$set(e.query,"name",t)},expression:"query.name"}}),e._v(" "),s("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"small"},on:{click:e.search}})],1)]),e._v(" "),s("el-table",{ref:"roleTable",staticStyle:{width:"100%"},attrs:{data:e.allRole,border:""},on:{select:e.select}},[s("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"角色名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"remark",label:"角色描述"},scopedSlots:e._u([{key:"default",fn:function(t){return s("div",{},[e._v(e._s(t.row.remark?t.row.remark:"暂无描述"))])}}])})],1),e._v(" "),s("el-pagination",{staticStyle:{"text-align":"center","margin-top":"20px"},attrs:{background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"page-size":e.query.pageSize},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){return e.$set(e.query,"pageNum",t)},"update:current-page":function(t){return e.$set(e.query,"pageNum",t)}}}),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancel()}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.btnOk}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports,d=s(183);var p=(()=>{let e=class extends o.c{constructor(){super(...arguments),this.nums=d.a,this.edit=!1,this.form={id:null,username:null,password:null,repassword:null},this.btnLoading=!1,this.rules={username:[{required:!0,message:"请输入用户名",trigger:["change","blur"]}],password:[{required:!0,message:"请输入密码",trigger:["change","blur"]}]}}onDataChange(){this.account?(this.edit=!0,this.$Utils.copyProperties(this.account,this.form)):this.edit=!1}async btnOk(){let e=this.form.id?l.a.update:l.a.save;const t=this.$refs.accountForm;t.validate(s=>{if(!s)return this.$message.error("表单填写有误"),!1;e.request(this.form).then(e=>{this.$message.success("操作成功"),this.$emit("val-change",this.form),this.btnLoading=!0,setTimeout(()=>{this.btnLoading=!1},1e3),t.resetFields(),this.$Utils.resetProperties(this.form)})})}cancel(){this.$emit("update:visible",!1),setTimeout(()=>{this.$emit("update:account",null)},800),this.$emit("cancel");const e=this.$refs.accountForm;setTimeout(()=>{e.resetFields(),this.$Utils.resetProperties(this.form)},200)}};return Object(a.a)([Object(o.b)()],e.prototype,"visible",void 0),Object(a.a)([Object(o.b)()],e.prototype,"account",void 0),Object(a.a)([Object(o.b)()],e.prototype,"title",void 0),Object(a.a)([Object(o.d)("account",{deep:!0})],e.prototype,"onDataChange",null),e=Object(a.a)([Object(o.a)({name:"AccountEdit"})],e),e})(),h=Object(c.a)(p,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"account-dialog"},[s("el-dialog",{attrs:{title:e.title,visible:e.visible,"show-close":!1,width:"35%"}},[s("el-form",{ref:"accountForm",attrs:{model:e.form,rules:e.rules,"label-width":"85px",size:"small"}},[s("el-form-item",{attrs:{prop:"username",label:"用户名:",required:""}},[s("el-input",{attrs:{disabled:e.edit,placeholder:"请输入用户名","auto-complete":"off"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"==typeof t?t.trim():t)},expression:"form.username"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"password",label:"密码:",required:""}},[s("el-input",{attrs:{type:"password",placeholder:"请输入密码",autocomplete:"new-password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"==typeof t?t.trim():t)},expression:"form.password"}})],1),e._v(" "),e.edit?e._e():s("el-form-item",{attrs:{label:"确认密码:",required:""}},[s("el-input",{attrs:{type:"password",placeholder:"请输入确认密码",autocomplete:"new-password"},model:{value:e.form.repassword,callback:function(t){e.$set(e.form,"repassword","string"==typeof t?t.trim():t)},expression:"form.repassword"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.cancel()}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.btnOk}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports;var m=(()=>{let e=class extends o.c{constructor(){super(...arguments),this.enums=d.a,this.permission=i.a,this.chooseId=null,this.chooseData=null,this.query={pageNum:1,pageSize:10},this.datas=[],this.total=0,this.showRoleDialog={title:"",visible:!1,accountRoles:[]},this.showResourceDialog={title:"",visible:!1,resources:[],defaultProps:{children:"children",label:"name"}},this.roleDialog={visible:!1,account:null,roles:[]},this.accountDialog={visible:!1,data:null}}mounted(){this.search()}choose(e){e&&(this.chooseId=e.id,this.chooseData=e)}async search(){let e=await l.a.list.request(this.query);this.datas=e.list,this.total=e.total}async showResources(e){let t=this.showResourceDialog;t.title='"'+e.username+'" 的菜单&权限',t.resources=[],t.resources=await l.a.resources.request({id:e.id}),t.visible=!0}async showRoles(e){let t=this.showRoleDialog;t.title='"'+e.username+'" 的角色信息',t.accountRoles=await l.a.roles.request({id:e.id}),t.visible=!0}async changeStatus(e){let t=e.id,s=e.status?1:0;await l.a.changeStatus.request({id:t,status:s}),this.$message.success("操作成功"),this.search()}handlePageChange(e){this.query.pageNum=e,this.search()}roleEdit(){this.chooseId||this.$message.error("请选择账号"),this.roleDialog.visible=!0,this.roleDialog.account=this.chooseData}editAccount(e=!1){this.accountDialog.data=e?null:this.chooseData,this.accountDialog.visible=!0}cancel(){this.roleDialog.visible=!1,this.roleDialog.account=null,this.search()}valChange(){this.accountDialog.visible=!1,this.search()}async deleteAccount(){try{await l.a.del.request({id:this.chooseId}),this.$message.success("删除成功"),this.search()}catch(e){this.$message.error("刪除失败")}}};return e=Object(a.a)([Object(o.a)({name:"account-list",components:{HelpHint:r.a,RoleEdit:u,AccountEdit:h}})],e),e})(),v=Object(c.a)(m,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"role-list"},[s("div",{staticClass:"toolbar"},[s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:function(t){return e.editAccount(!0)}}},[e._v("添加")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{disabled:null==e.chooseId,type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.editAccount(!1)}}},[e._v("编辑")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.saveRoles.code,expression:"permission.saveRoles.code"}],attrs:{disabled:null==e.chooseId,type:"success",icon:"el-icon-setting",size:"mini"},on:{click:function(t){return e.roleEdit()}}},[e._v("角色分配")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.del.code,expression:"permission.del.code"}],attrs:{disabled:null==e.chooseId,type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.deleteAccount()}}},[e._v("删除")]),e._v(" "),s("div",{staticStyle:{float:"right"}},[s("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"请输入账号名",size:"small",clearable:""},on:{clear:function(t){return e.search()}},model:{value:e.query.username,callback:function(t){e.$set(e.query,"username",t)},expression:"query.username"}}),e._v(" "),s("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.search()}}})],1)],1),e._v(" "),s("el-table",{ref:"table",attrs:{data:e.datas,border:"","show-overflow-tooltip":""},on:{"current-change":e.choose}},[s("el-table-column",{attrs:{label:"选择",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-radio",{attrs:{label:t.row.id},model:{value:e.chooseId,callback:function(t){e.chooseId=t},expression:"chooseId"}},[s("i")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"username",label:"用户名","min-width":"115"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",prop:"status",label:"状态","min-width":"63"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tooltip",{attrs:{content:1==t.row.status?"启用":"禁用",placement:"top"}},[s("el-switch",{attrs:{"active-value":1,"active-color":"#13ce66","inactive-color":"#ff4949",disabled:!e.$Permission.getPermission(e.permission.changeStatus.code).show||e.$Permission.getPermission(e.permission.changeStatus.code).disabled},on:{change:function(s){return e.changeStatus(t.row)}},model:{value:t.row.status,callback:function(s){e.$set(t.row,"status",s)},expression:"scope.row.status"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"115",prop:"creator",label:"创建账号"}}),e._v(" "),s("el-table-column",{attrs:{"min-width":"160",prop:"createTime",label:"创建时间"}}),e._v(" "),s("el-table-column",{attrs:{"min-width":"115",prop:"modifier",label:"更新账号"}}),e._v(" "),s("el-table-column",{attrs:{"min-width":"160",prop:"updateTime",label:"修改时间"}}),e._v(" "),s("el-table-column",{attrs:{"min-width":"160",prop:"lastLoginTime",label:"最后登录时间"}}),e._v(" "),s("el-table-column",{attrs:{label:"查看更多","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{type:"success"},on:{click:function(s){return e.showRoles(t.row)}}},[e._v("角色")]),e._v(" "),s("el-link",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.account.code,expression:"permission.account.code"}],attrs:{type:"info"},on:{click:function(s){return e.showResources(t.row)}}},[e._v("菜单&权限")])]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"120",prop:"remark",label:"备注","show-overflow-tooltip":""}})],1),e._v(" "),s("el-pagination",{staticStyle:{"text-align":"center"},attrs:{background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"page-size":e.query.pageSize},on:{"current-change":e.handlePageChange,"update:currentPage":function(t){return e.$set(e.query,"pageNum",t)},"update:current-page":function(t){return e.$set(e.query,"pageNum",t)}}}),e._v(" "),s("el-dialog",{attrs:{width:"500px",title:e.showRoleDialog.title,visible:e.showRoleDialog.visible},on:{"update:visible":function(t){return e.$set(e.showRoleDialog,"visible",t)}}},[s("el-table",{attrs:{border:"",data:e.showRoleDialog.accountRoles}},[s("el-table-column",{attrs:{property:"name",label:"角色名",width:"125"}}),e._v(" "),s("el-table-column",{attrs:{property:"creator",label:"分配账号",width:"125"}}),e._v(" "),s("el-table-column",{attrs:{property:"createTime",label:"分配时间"}})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.showResourceDialog.title,visible:e.showResourceDialog.visible,width:"400px",height:"400px"},on:{"update:visible":function(t){return e.$set(e.showResourceDialog,"visible",t)}}},[s("el-tree",{staticStyle:{height:"50vh",overflow:"auto"},attrs:{data:e.showResourceDialog.resources,"node-key":"id",props:e.showResourceDialog.defaultProps,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,o=t.data;return s("span",{staticClass:"custom-tree-node"},[o.type==e.enums.ResourceTypeEnum.MENU.value?s("span",[e._v(e._s(a.label))]):e._e(),e._v(" "),o.type==e.enums.ResourceTypeEnum.PERMISSION.value?s("span",{staticStyle:{color:"#67c23a"}},[e._v(e._s(a.label))]):e._e()])}}])})],1),e._v(" "),s("role-edit",{attrs:{visible:e.roleDialog.visible,account:e.roleDialog.account},on:{cancel:function(t){return e.cancel()}}}),e._v(" "),s("account-edit",{attrs:{visible:e.accountDialog.visible,account:e.accountDialog.data},on:{"update:visible":function(t){return e.$set(e.accountDialog,"visible",t)},"update:account":function(t){return e.$set(e.accountDialog,"data",t)},"val-change":function(t){return e.valChange()}}})],1)}),[],!1,null,null,null).exports}}]);