(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{168:function(e,t,s){"use strict";var i,a=s(19),r=s.n(a),o=s(36),l=s(184),n=s.n(l),c=s(10),u=s(1);!function(e){e[e.SUCCESS=200]="SUCCESS",e[e.ERROR=400]="ERROR",e[e.PARAM_ERROR=405]="PARAM_ERROR",e[e.SERVER_ERROR=500]="SERVER_ERROR",e[e.NO_PERMISSION=501]="NO_PERMISSION"}(i||(i={}));const d=u.a.apiUrl;function m(e){r.a.Message.error(e)}const p=n.a.create({baseURL:d,timeout:5e3});function v(e,t){return e.replace(/\{\w+\}/g,e=>{let s=e.substring(1,e.length-1),i=t[s];return null!=i||null!=i?i:""})}function f(e,t,s){if(!t)throw new Error("请求url不能为空");-1!=t.indexOf("{")&&(t=v(t,s));const i={method:e,url:t},a=e.toLowerCase();return"post"===a||"put"===a?i.data=s:i.params=s,p.request(i).then(e=>e).catch(e=>(m(e.msg||e.message),Promise.reject(e)))}p.interceptors.request.use(e=>{const t=c.a.getToken();return t&&(e.headers.token=t),e},e=>(console.log(e),Promise.reject(e))),p.interceptors.response.use(e=>{const t=e.data;return t.code===i.NO_PERMISSION?(c.a.removeToken(),m("登录超时"),void setTimeout(()=>{o.a.push({path:"/login"})},1e3)):t.code===i.SUCCESS?t.data:Promise.reject(t)},e=>Promise.reject(e)),t.a={request:f,send:function(e,t){return f(e.method,e.url,t)},parseRestUrl:v,getApiUrl:function(e){return d+"?token="+c.a.getToken()}}},171:function(e,t,s){"use strict";var i=s(168);class a{constructor(e,t){this.url=e,this.method=t}setUrl(e){return this.url=e,this}setMethod(e){return this.method=e,this}getUrl(){return i.a.getApiUrl(this.url)}request(e){return i.a.send(this,e)}static create(e,t){return new a(e,t)}}t.a=a},213:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return o}));var i=s(10);const a={machine:i.a.code("machine"),del:i.a.code("machine:delete"),machineFile:i.a.code("machineFile"),rmFile:i.a.code("machineFile:rm"),uploadFile:i.a.code("machineFile:upload"),updateFileContent:i.a.code("machineFile:updateFileContent"),addConf:i.a.code("machineFile:addConf")},r={redis:i.a.code("redis")},o={redisKey:i.a.code("redis:key"),del:i.a.code("redis:key:delete")}},214:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return r})),s.d(t,"c",(function(){return o}));var i=s(171);const a={list:i.a.create("/devops/machines","get"),save:i.a.create("/devops/machines","post"),update:i.a.create("/devops/machines/{id}","put"),del:i.a.create("/devops/machines/{id}","delete"),files:i.a.create("/devops/machines/{id}/files","get"),lsFile:i.a.create("/devops/machines/files/{fileId}/ls","get"),rmFile:i.a.create("/devops/machines/files/{fileId}/rm","delete"),uploadFile:i.a.create("/devops/machines/files/upload","post"),fileContent:i.a.create("/devops/machines/files/{fileId}/cat","get"),updateFileContent:i.a.create("/devops/machines/files/{id}","put"),addConf:i.a.create("/devops/machines/{machineId}/files","post"),delConf:i.a.create("/devops/machines/files/{id}","delete")},r={list:i.a.create("/devops/redis","get"),info:i.a.create("/devops/redis/{id}/info","get"),del:i.a.create("/devops/redis/{id}","delete"),save:i.a.create("/devops/redis","post"),update:i.a.create("/devops/redis/{id}","put")},o={scan:i.a.create("/devops/redis/{cluster}/{id}/scan","get"),value:i.a.create("/devops/redis/{cluster}/{id}/value","get"),update:i.a.create("/devops/redis/{cluster}/{id}","put"),del:i.a.create("/devops/redis/{cluster}/{id}","delete")}},301:function(e,t,s){var i=s(34),a=s(734);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};i(a,r);e.exports=a.locals||{}},303:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s(61),a=s(33);var r=(()=>{let e=class extends a.c{constructor(){super(...arguments),this.form={},this.submitDisabled=!1}onRoleChange(){this.formData&&(this.form={...this.formData})}submit(){this.$refs.dynamicForm.validate(e=>{if(!e)return!1;{let e={...this.form},t=this.form.id?this.formInfo.updateApi:this.formInfo.createApi;t?(this.submitDisabled=!0,t.request(this.form).then(t=>{this.$message.success("保存成功"),this.$emit("submitSuccess",e),this.submitDisabled=!1},e=>{this.submitDisabled=!1})):this.$message.error("表单未设置对应的提交权限")}})}reset(){this.$emit("reset"),this.resetFieldsAndData()}resetFieldsAndData(){this.$refs.dynamicForm.resetFields(),this.form={}}mounted(){this.form={...this.formData}}};return Object(i.a)([Object(a.b)()],e.prototype,"formInfo",void 0),Object(i.a)([Object(a.b)()],e.prototype,"formData",void 0),Object(i.a)([Object(a.d)("formData",{deep:!0})],e.prototype,"onRoleChange",null),e=Object(i.a)([Object(a.a)({name:"DynamicForm"})],e),e})(),o=s(60),l=Object(o.a)(r,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dynamic-form"},[s("el-form",{ref:"dynamicForm",attrs:{model:e.form,"label-width":e.formInfo.labelWidth?e.formInfo.labelWidth:"100px",size:e.formInfo.size?e.formInfo.size:"small"}},[e._l(e.formInfo.formRows,(function(t){return s("el-row",{key:t.key},e._l(t,(function(i){return s("el-col",{key:i.key,attrs:{span:i.span?i.span:24/t.length}},[s("el-form-item",{attrs:{prop:i.name,label:i.label,"label-width":i.labelWidth,required:i.required,rules:i.rules}},["input"===i.type?s("el-input",{attrs:{placeholder:i.placeholder,type:i.inputType,clearable:"",autocomplete:"new-password"},on:{change:function(t){i.change&&i.change(e.form)}},model:{value:e.form[i.name],callback:function(t){e.$set(e.form,i.name,"string"==typeof t?t.trim():t)},expression:"form[item.name]"}}):"text"===i.type?s("span",[e._v(e._s(e.form[i.name]))]):"select"===i.type?s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:i.placeholder,filterable:i.filterable,remote:i.remote,"remote-method":i.remoteMethod,clearable:"",disabled:i.updateDisabled&&null!=e.form.id},on:{focus:function(t){i.focus&&i.focus(e.form)}},model:{value:e.form[i.name],callback:function(t){e.$set(e.form,i.name,"string"==typeof t?t.trim():t)},expression:"form[item.name]"}},e._l(i.options,(function(e){return s("el-option",{key:e.key,attrs:{label:e[i.optionProps&&i.optionProps.label||"label"],value:e[i.optionProps&&i.optionProps.value||"value"]}})})),1):e._e()],1)],1)})),1)})),e._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[e._t("btns",[s("el-button",{attrs:{size:"mini"},on:{click:e.reset}},[e._v("重 置")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submit}},[e._v("保 存")])],{submitDisabled:e.submitDisabled,data:e.form,submit:e.submit})],2)],2)],1)}),[],!1,null,null,null).exports;var n=(()=>{let e=class extends a.c{close(){this.$emit("update:visible",!1),this.$emit("update:formData",null),this.$emit("close"),setTimeout(()=>{this.$refs.df.resetFieldsAndData()},200)}submitSuccess(e){this.$emit("submitSuccess",e),this.close()}};return Object(i.a)([Object(a.b)()],e.prototype,"visible",void 0),Object(i.a)([Object(a.b)()],e.prototype,"dialogWidth",void 0),Object(i.a)([Object(a.b)()],e.prototype,"title",void 0),Object(i.a)([Object(a.b)()],e.prototype,"formInfo",void 0),Object(i.a)([Object(a.b)()],e.prototype,"formData",void 0),e=Object(i.a)([Object(a.a)({name:"DynamicFormDialog",components:{DynamicForm:l}})],e),e})(),c=Object(o.a)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"form-dialog"},[s("el-dialog",{attrs:{title:e.title,visible:e.visible,width:e.dialogWidth?e.dialogWidth:"500px"}},[s("dynamic-form",{ref:"df",attrs:{"form-info":e.formInfo,"form-data":e.formData},on:{submitSuccess:e.submitSuccess},scopedSlots:e._u([{key:"btns",fn:function(t){return[e._t("btns",[s("el-button",{attrs:{disabled:t.submitDisabled,type:"primary",size:"mini"},on:{click:t.submit}},[e._v("保 存")]),e._v(" "),s("el-button",{attrs:{disabled:t.submitDisabled,size:"mini"},on:{click:function(t){return e.close()}}},[e._v("取 消")])])]}}],null,!0)})],1)],1)}),[],!1,null,null,null).exports},733:function(e,t,s){"use strict";var i=s(301);s.n(i).a},734:function(e,t,s){(t=s(35)(!1)).push([e.i,"\n.row .title {\n  font-size: 12px;\n}\n.row .value {\n  font-size: 12px;\n  color: black;\n}\n",""]),e.exports=t},744:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return m}));var i=s(61),a=s(33);var r=(()=>{let e=class extends a.c{close(){this.$emit("update:visible",!1),this.$emit("close")}};return Object(i.a)([Object(a.b)()],e.prototype,"title",void 0),Object(i.a)([Object(a.b)()],e.prototype,"visible",void 0),Object(i.a)([Object(a.b)()],e.prototype,"info",void 0),e=Object(i.a)([Object(a.a)({name:"Info"})],e),e})(),o=(s(733),s(60)),l=Object(o.a)(r,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:e.title,visible:e.visible,"show-close":!0,width:"35%"},on:{close:function(t){return e.close()}}},[s("el-collapse",[s("el-collapse-item",{attrs:{title:"Server(Redis服务器的一般信息)",name:"server"}},[s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("redis_version(版本):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Server.redis_version))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("tcp_port(端口):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Server.tcp_port))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("redis_mode(模式):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Server.redis_mode))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("os(宿主操作系统):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Server.os))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("uptime_in_days(运行天数):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Server.uptime_in_days))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("executable(可执行文件路径):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Server.executable))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("config_file(配置文件路径):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Server.config_file))])])]),e._v(" "),s("el-collapse-item",{attrs:{title:"Clients(客户端连接部分)",name:"client"}},[s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("connected_clients(已连接客户端数):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Clients.connected_clients))])])]),e._v(" "),s("el-collapse-item",{attrs:{title:"Memory(内存消耗相关信息)",name:"memory"}},[s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("used_memory(分配内存总量):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Memory.used_memory_human))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("used_memory_rss(已分配的内存总量，操作系统角度):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Memory.used_memory_rss_human))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("mem_fragmentation_ratio(used_memory_rss和used_memory 之间的比率):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Memory.mem_fragmentation_ratio))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("used_memory_peak(内存消耗峰值):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Memory.used_memory_peak_human))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("total_system_memory(主机总内存):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.Memory.total_system_memory_human))])])]),e._v(" "),s("el-collapse-item",{attrs:{title:"CPU",name:"cpu"}},[s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("used_cpu_sys(由Redis服务器消耗的系统CPU):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.CPU.used_cpu_sys))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("used_cpu_user(由Redis服务器消耗的用户CPU):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.CPU.used_cpu_user))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("used_cpu_sys_children(由后台进程消耗的系统CPU):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.CPU.used_cpu_sys_children))])]),e._v(" "),s("div",{staticClass:"row"},[s("span",{staticClass:"title"},[e._v("used_cpu_user_children(由后台进程消耗的用户CPU):")]),e._v(" "),s("span",{staticClass:"value"},[e._v(e._s(e.info.CPU.used_cpu_user_children))])])])],1)],1)],1)}),[],!1,null,null,null).exports,n=s(213),c=s(214),u=s(303);var d=(()=>{let e=class extends a.c{constructor(){super(...arguments),this.validatePort=(e,t,s)=>{(t>65535||t<1)&&s(new Error("端口号错误")),s()},this.redisTable=[],this.permission=n.c,this.keyPermission=n.b,this.currentId=null,this.currentData=null,this.params={host:null,clusterId:null},this.redisInfo={url:""},this.clusters=[{id:0,name:"单机"}],this.infoDialog={title:"",visible:!1,info:{Server:{},Keyspace:{},Clients:{},CPU:{},Memory:{}}},this.formDialog={visible:!1,title:"",formInfo:{createApi:c.b.save,updateApi:c.b.update,formRows:[[{type:"input",label:"主机：",name:"host",placeholder:"请输入节点ip",rules:[{required:!0,message:"请输入节点ip",trigger:["blur","change"]}]}],[{type:"input",label:"端口号：",name:"port",placeholder:"请输入节点端口号",inputType:"number",rules:[{required:!0,message:"请输入节点端口号",trigger:["blur","change"]}]}],[{type:"input",label:"密码：",name:"pwd",placeholder:"请输入节点密码",inputType:"password"}],[{type:"input",label:"描述：",name:"description",placeholder:"请输入节点描述",inputType:"textarea"}]]},formData:{port:6379}}}mounted(){this.search()}choose(e){e&&(this.currentId=e.id,this.currentData=e)}async deleteNode(){await c.b.del.request({id:this.currentId}),this.$message.success("删除成功"),this.search()}manage(e){this.$router.push(`/redis_operation/${e.clusterId}/${e.id}`)}info(e){c.b.info.request({id:e.id}).then(t=>{this.infoDialog.info=t,this.infoDialog.title=`'${e.host}' info`,this.infoDialog.visible=!0})}search(){c.b.list.request(this.params).then(e=>{this.redisTable=e})}openFormDialog(e){let t;e?(this.formDialog.formData=this.currentData,t="编辑redis节点"):(this.formDialog.formData={port:6379},t="添加redis节点"),this.formDialog.title=t,this.formDialog.visible=!0}submitSuccess(){this.currentId=null,this.currentData=null,this.search()}};return e=Object(i.a)([Object(a.a)({name:"RedisList",components:{Info:l,DynamicFormDialog:u.a}})],e),e})(),m=Object(o.a)(d,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"toolbar"},[s("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",plain:""},on:{click:function(t){return e.openFormDialog(!1)}}},[e._v("添加")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-edit",disabled:null==e.currentId,size:"mini",plain:""},on:{click:function(t){return e.openFormDialog(e.currentData)}}},[e._v("编辑")]),e._v(" "),s("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:null==e.currentId,size:"mini",plain:""},on:{click:e.deleteNode}},[e._v("删除")]),e._v(" "),s("div",{staticStyle:{float:"right"}},[s("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"host",size:"mini",plain:"",clearable:""},on:{clear:e.search},model:{value:e.params.host,callback:function(t){e.$set(e.params,"host",t)},expression:"params.host"}}),e._v(" "),s("el-select",{attrs:{size:"mini",clearable:"",placeholder:"集群选择"},model:{value:e.params.clusterId,callback:function(t){e.$set(e.params,"clusterId",t)},expression:"params.clusterId"}},e._l(e.clusters,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1),e._v(" "),s("el-button",{attrs:{type:"success",icon:"el-icon-search",size:"mini"},on:{click:e.search}})],1)],1),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.redisTable,stripe:""},on:{"current-change":e.choose}},[s("el-table-column",{attrs:{label:"选择",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-radio",{attrs:{label:t.row.id},model:{value:e.currentId,callback:function(t){e.currentId=t},expression:"currentId"}},[s("i")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"host",label:"IP",width:""}}),e._v(" "),s("el-table-column",{attrs:{prop:"port",label:"端口",width:""}}),e._v(" "),s("el-table-column",{attrs:{prop:"clusterId",label:"集群id"}}),e._v(" "),s("el-table-column",{attrs:{prop:"description",label:"描述"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.permission.redis.code,expression:"permission.redis.code"}],ref:t.row,attrs:{type:"primary",icom:"el-icon-tickets",size:"mini",plain:""},on:{click:function(s){return e.info(t.row)}}},[e._v("info")]),e._v(" "),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.keyPermission.redisKey.code,expression:"keyPermission.redisKey.code"}],ref:t.row,attrs:{type:"success",size:"mini",plain:""},on:{click:function(s){return e.manage(t.row)}}},[e._v("数据管理")])]}}])})],1),e._v(" "),s("Info",{attrs:{visible:e.infoDialog.visible,title:e.infoDialog.title,info:e.infoDialog.info},on:{"update:visible":function(t){return e.$set(e.infoDialog,"visible",t)}}}),e._v(" "),s("dynamic-form-dialog",{attrs:{"dialog-width":e.formDialog.dialogWidth,visible:e.formDialog.visible,title:e.formDialog.title,"form-info":e.formDialog.formInfo,"form-data":e.formDialog.formData},on:{"update:visible":function(t){return e.$set(e.formDialog,"visible",t)},"update:formData":function(t){return e.$set(e.formDialog,"formData",t)},"update:form-data":function(t){return e.$set(e.formDialog,"formData",t)},submitSuccess:e.submitSuccess}})],1)}),[],!1,null,null,null).exports}}]);